<HTML>
<CENTER><A HREF = "http://www.cfdem.com">LIGGGHTS WWW Site</A> - <A HREF = "http://lammps.sandia.gov">LAMMPS WWW Site</A> - <A HREF = "Manual.html">LIGGGHTS Documentation</A> - <A HREF = "Section_commands.html#comm">LIGGGHTS Commands</A> 
</CENTER>








<HR>

<H3>fix forcecontrol/region command 
</H3>
<P><B>Syntax:</B>
</P>
<PRE>fix ID group-ID forcecontrol/region control_keywords control_values 
</PRE>
<UL><LI>ID, group-ID are documented in <A HREF = "fix.html">fix</A> command 

<LI>forcecontrol/region = style name of this fix command 

<LI>control_keyword/value pairs 

<LI>control_keywords = <I>ctrlPV</I> (obligatory) or <I>actual_val</I> (obligatory) or <I>target_val</I> (obligatory) or <I>kp</I> or <I>ki</I> or <I>kd</I> or <I>cg</I> 

<PRE><I>ctrlPV</I> values = stress or velocity
    stress = use stress as control process value
    velocity = use velocity as control process value
<I>actual_val</I> values = fix-ID
    fix-ID = ID of a <A HREF = "fix_ave_euler_region.html">fix ave/euler/region</A> command that holds the actual values for the controller
<I>target_val</I> values = fix-ID
    fix-ID = ID of a <A HREF = "fix_ave_euler_region.html">fix ave/euler/region</A> command that holds the target values for the controller
<I>kp</I> values = k
    k = proportional constant for PID controller 
<I>ki</I> values = k
    k = integral constant for PID controller
<I>kd</I> values = k
    k = differential constant for PID controller
<I>cg</I> values = cg
    cg = coarse grain ratio of the target particles 
</PRE>

</UL>
<P><B>Examples:</B>
</P>
<PRE>fix stressctrl resolved forcecontrol/region ctrlPV stress actual_val resolvedave target_val coarseave kp 1. ki 10000. cg 2
fix velocityctrl coarse forcecontrol/region ctrlPV velocity actual_val coarseave target_val resolvedave kp 0.1 
</PRE>
<P><B>Description:</B>
</P>
<P>This fix applies cell-wise forces on particles inside a hexhedral grid
until either a granular pressure (for <I>ctrlPV</I> = stress) or an average
velocity (for <I>ctrlPV</I> = velocity) is reached.
The actual cell-wise stress or velocity values are calculated by a
<A HREF = "fix_ave_euler_region.html">fix ave/euler/region</A>, which is defined via
the keyword <I>actual_val</I>. 
The cell-wise target stress or velocity values are calculated by a
<A HREF = "fix_ave_euler_region.html">fix ave/euler/region</A>, which is defined via
the keyword <I>target_val</I>. 
</P>
<P>For <I>ctrlPV</I> = stress the controller force is applied only in a boundary
layer of a cell with a thickness of 1.3 times the maximum particle diameter
d_max. After this layer the force decays in a sine squared fashion within
0.25*d_max. The direction of the force is determined via the grid geometry
which should hold a vectorial element property with the label 'stress_ctrl_dir'
(e.g. by specifying a cell_data property in the VTK geometry file).
</P>
<P>For <I>ctrlPV</I> = velocity the controller force is kept constant over
the whole cell.
</P>
<P>The controller itself is a proportional-integral-derivative (PID)
controller which is defined by 3 constants <I>kp</I>, <I>ki</I>, <I>kd</I>:
</P>
<P>output = kp * error + ki * errorsum + kd * errorchange
</P>
<P>where 'error' is the current deviation of the control process value to the target value, 
'errorsum' is the time integration (sum) of the error values and 'errorchange' its derivative.
</P>
<P>The <I>cg</I> parameter allows to specify the coarse grain ratio of the target particles
in adaptive resolution simulations.
</P>
<P><B>Restart, fix_modify, output, run start/stop, minimize info:</B>
</P>
<P>This fix supports <A HREF = "fix_modify.html">fix_modify</A> with option <I>activate</I>/<I>deactivate</I> = cell-ID
to turn on/off the force controller for individual grid cells.
</P>
<P>This fix also supports <A HREF = "fix_modify.html">fix_modify</A> with option <I>massflow_correction_on</I>/<I>massflow_correction_off</I> = cell-ID
to turn on/off corrections to a 'velocity' controller to achieve proper mass flow rates.
</P>
<P><B>Related commands:</B>
</P>
<P><A HREF = "fix_ave_euler_region.html">fix ave/euler/region</A>, <A HREF = "region.html">region mesh/hex</A>
</P>
<P><B>Default:</B> 
</P>
<P>kp = 1, ki = 0, kd = 0, cg = 1
</P>
</HTML>
